[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

[[patches]]
[patches.pattern]
target = 'card.lua'
match_indent = false
position = 'at'
pattern = '''
                    nominal_chips = self.base.nominal > 0 and self.base.nominal or nil,
'''
payload = '''
                    nominal_chips = (self.base.nominal > 0 and "+" or "")..(self.base.nominal or ""),
'''

# Changes title screen Ace to Negative Ace
[[patches]]
[patches.pattern]
target = 'game.lua'
pattern = '''local replace_card = Card(self.title_top.T.x, self.title_top.T.y, 1.2*G.CARD_W*SC_scale, 1.2*G.CARD_H*SC_scale, G.P_CARDS.S_A, G.P_CENTERS.c_base)'''
position = "at"
payload = ''' 
local replace_card = Card(self.title_top.T.x, self.title_top.T.y, 1.2*G.CARD_W*SC_scale, 1.2*G.CARD_H*SC_scale, G.P_CARDS["S_deg_-A"], G.P_CENTERS.c_base)
'''
match_indent = true

#G.GAME stuff
[[patches]]
[patches.pattern]
target = 'game.lua'
pattern = '''unused_discards = 0,'''
position = "after"
payload = '''
deg = {
    og_negative_vals = {}
},
'''
match_indent = true

# Untitled Joker
[[patches]]
[patches.pattern]
target = '=[SMODS _ "src/utils.lua"]'
pattern = """    if specific_vars and specific_vars.bonus_h_dollars then
        localize{type = 'other', key = 'card_extra_h_dollars', nodes = desc_nodes, vars = {SMODS.signed_dollars(specific_vars.bonus_h_dollars)}}
    end"""
position = "after"
payload = """
if specific_vars and G.GAME.deg_t2 and specific_vars.value then
    local nominal = specific_vars.value
    local original_chip = G.GAME.deg.og_negative_vals[nominal] or 0
    if original_chip < 0 then
        localize{type = 'other', key = 'deg_negative_mult', nodes = desc_nodes, vars = { "+" .. -G.GAME.deg.og_negative_vals[nominal] }}
    end
end
"""
match_indent = true

# Makes level colour red when below 0, Borrowed from Hodgepodge, check out Ren's Mod!

[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = '''
G.hand_text_area.hand_level.config.colour = G.C.HAND_LEVELS[math.min(vals.level, 7)]
'''
position = "at"
payload = '''
G.hand_text_area.hand_level.config.colour = to_big(vals.level) < to_big(1) and G.C.RED or G.C.HAND_LEVELS[math.min(vals.level, 7)]
'''
match_indent = true

[[patches]]
[patches.pattern]
target = "functions/UI_definitions.lua"
pattern = '''
{n=G.UIT.C, config={align = "cm", padding = 0.01, r = 0.1, colour = G.C.HAND_LEVELS[math.min(7, G.GAME.hands[handname].level)], minw = 1.5, outline = 0.8, outline_colour = G.C.WHITE}, nodes={
'''
position = "at"
payload = '''
{n=G.UIT.C, config={align = "cm", padding = 0.01, r = 0.1, colour = to_big(G.GAME.hands[handname].level) < to_big(1) and G.C.RED or G.C.HAND_LEVELS[math.min(7, G.GAME.hands[handname].level)], minw = 1.5, outline = 0.8, outline_colour = G.C.WHITE}, nodes={
'''
match_indent = true
